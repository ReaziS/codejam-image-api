!function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t){window.addEventListener("load",()=>{const e=document.getElementById("canv"),t=e.getContext("2d");let n=!1,o=128;e.width=o,e.height=o;const r=512;let a=r/o;const c=document.getElementById("currentColor"),l=document.getElementById("prevColor"),i=document.getElementById("imageSize"),d=document.getElementById("grayscale");let u,s,f={};function m(e,t){"currentColor"===e&&(f.currentColor=t),"prevColor"===e&&(f.prevColor=t),"canvasImgFromState"===e&&(f.canvasImgFromState=t,console.log(t)),"currentSize"===e&&(f.currentSize=t),localStorage.setItem("state",JSON.stringify(f))}function g(){t.fillStyle=u,t.rect(0,0,o,o),t.fill()}function v(){n=!0}function h(){n=!1}function p(e){const n=function(e){let t=Number(e).toString(16);return t.length<2&&(t=`0${t}`),t},o=t.getImageData(Math.floor(e.offsetX/a),Math.floor(e.offsetY/a),1,1);u=`#${function(e,t,o){const r=n(e),a=n(t),c=n(o);return"00"===r&&"00"===a&&"00"===c?"ffffff":r+a+c}(o.data[0],o.data[1],o.data[2])}`,t.fillStyle=u,c.value=u,t.save(),m("currentColor",u)}function y(e){n&&(t.beginPath(),t.fillStyle=u,t.fillRect(Math.floor(e.offsetX/a),Math.floor(e.offsetY/a),1,1),t.stroke())}localStorage.getItem("state")?(f=JSON.parse(localStorage.getItem("state")),u=f.currentColor?f.currentColor:"#ffffff",c.value=u,s=f.prevColor?f.prevColor:"#000000",l.value=s,f.canvasImgFromState&&D()):(u="#ffffff",c.value=u,s="#000000",l.value=s);const E=[];function I(){E.map(t=>(e.removeEventListener("mousedown",t[Object.keys(t)[0]]),e.removeEventListener("mouseup",t[Object.keys(t)[0]]),e.removeEventListener("mousemove",t[Object.keys(t)[0]]),e))}let b,S,L,k,w,B,C,M;function P(e){w=Math.floor(e.offsetX/a),B=Math.floor(e.offsetY/a)}function j(e){C=Math.floor(e.offsetX/a),M=Math.floor(e.offsetY/a),function(e,n,o,r){const a=Math.abs(o-e),c=e<o?1:-1,l=-Math.abs(r-n),i=n<r?1:-1;let d,s=a+l,f=!1;for(t.fillStyle=u,t.beginPath();!f;)t.rect(e,n,1,1),e===o&&n===r?f=!0:((d=2*s)>l&&(s+=l,e+=c),d<a&&(s+=a,n+=i));t.fill()}(w,B,C,M)}function O(){document.querySelectorAll(".instrument").forEach(e=>{e.classList.remove("active")}),this.classList.add("active"),"pencil"===this.id&&(I(),E.length=0,e.addEventListener("mousedown",v),e.addEventListener("mouseup",h),e.addEventListener("mousemove",y),E.push({startDraw:v},{endDraw:h},{drawLine:y})),"bresenham"===this.id&&(I(),E.length=0,e.addEventListener("mousedown",P),e.addEventListener("mouseup",j),E.push({startPos:P},{endPos:j})),"colorPicker"===this.id&&(I(),E.length=0,e.addEventListener("mousedown",p),E.push({colorPickerInstrument:p})),"paintBucket"===this.id&&(I(),E.length=0,e.addEventListener("mousedown",g),E.push({paintBucket:g}))}let F=!1;function D(n,o){const r=new Image;r.setAttribute("crossorigin","anonymous"),t.imageSmoothingEnabled=!1,t.webkitImageSmoothingEnabled=!1,o?(r.src=o,m("canvasImgFromState",o)):(r.src=f.canvasImgFromState,r.height=512,r.width=512),r.onload=function(){t.drawImage(r,e.width/2-r.width/2/a,e.width/2-r.width/2/a,r.width/a,r.height/a)}}document.getElementById("loadRandomImgButton").addEventListener("click",(async function(){const e=`https://api.unsplash.com/photos/random?query=town,${document.getElementById("citySearch").value}&client_id=0eca6307463dee5325a2ae91a9da38db508f782489581ce710b85697aad07d09`;await fetch(e).then(e=>e.json()).then(e=>{D(0,e.urls.small),F=!0})}));const _=document.getElementById("clearCanvas");document.getElementById("saveToLocalStorage").addEventListener("click",(function(){m("canvasImgFromState",e.toDataURL("image/jpeg",1)),F=!1})),document.getElementById("loadFromLocalStorage").addEventListener("click",D),c.addEventListener("change",(function(e){l.value=u,m("prevColor",s=u),m("currentColor",u=e.target.value),console.log("sfa")})),l.addEventListener("click",(function(e){e.preventDefault();const t=u;c.value=s,m("currentColor",u=s),l.value=t,s=t,m("prevColor",t)})),document.addEventListener("keydown",(function(e){console.log(e),80===e.keyCode&&(b=document.getElementById("pencil"),O.apply(b)),66===e.keyCode&&(S=document.getElementById("paintBucket"),O.apply(S)),67===e.keyCode&&(L=document.getElementById("colorPicker"),O.apply(L))})),i.addEventListener("change",(function(t){m("currentSize",o=64*t.target.value),e.width=o,e.height=o,a=r/o,F?D(0,f.canvasImgFromState):D()})),d.addEventListener("click",(function(){const n=t.getImageData(0,0,e.width,e.height),o=n.data;for(let e=0;e<o.length;e+=4){const t=(o[e]+o[e+1]+o[e+2])/3;o[e]=t,o[e+1]=t,o[e+2]=t}t.putImageData(n,0,0)})),_.addEventListener("click",(function(){t.clearRect(0,0,e.width,e.height)})),(b=document.getElementById("pencil")).addEventListener("click",O.bind(b)),(S=document.getElementById("paintBucket")).addEventListener("click",O.bind(S)),(L=document.getElementById("colorPicker")).addEventListener("click",O.bind(L)),(k=document.getElementById("bresenham")).addEventListener("click",O.bind(k))})}]);